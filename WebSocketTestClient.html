<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket ì œì–´ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f4f7f9; }
    </style>
</head>
<body class="p-6 h-screen flex flex-col items-center">

    <div class="max-w-xl w-full bg-white p-8 rounded-xl shadow-2xl border border-gray-100">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">ë¡œë´‡ ì œì–´ WebSocket í…ŒìŠ¤í„°</h1>
        
        <div class="mb-4">
            <label for="websocketUrl" class="block text-sm font-medium text-gray-700">WebSocket URL</label>
            <input type="text" id="websocketUrl" value="ws://127.0.0.1:8000/ws/control" 
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-gray-50">
        </div>

        <div class="flex space-x-4 mb-6">
            <button id="connectButton" onclick="connect()" 
                    class="flex-1 px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150">
                ì—°ê²°
            </button>
            <button id="disconnectButton" onclick="disconnect()" disabled 
                    class="flex-1 px-4 py-2 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition duration-150 disabled:opacity-50">
                ì—°ê²° í•´ì œ
            </button>
        </div>

        <div class="mb-6">
            <label for="messageInput" class="block text-sm font-medium text-gray-700">ë³´ë‚¼ ëª…ë ¹ì–´ (JSON ë˜ëŠ” í…ìŠ¤íŠ¸)</label>
            <input type="text" id="messageInput" value='{"cmd": "move", "linear": 0.5}' 
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm">
            <button id="sendButton" onclick="sendMessage()" disabled
                    class="mt-2 w-full px-4 py-2 bg-green-500 text-white font-semibold rounded-lg shadow-md hover:bg-green-600 transition duration-150 disabled:opacity-50">
                ëª…ë ¹ ì „ì†¡
            </button>
        </div>

        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
            <h3 class="text-lg font-semibold text-gray-800 mb-2">ìƒíƒœ ë° ë¡œê·¸</h3>
            <div id="status" class="text-sm font-medium text-gray-600 mb-2">ìƒíƒœ: ì—°ê²°ë˜ì§€ ì•ŠìŒ</div>
            <textarea id="log" rows="8" readonly class="w-full p-2 text-xs bg-white border border-gray-300 rounded-md resize-none"></textarea>
        </div>
    </div>

    <script>
        let ws = null;
        const statusElement = document.getElementById('status');
        const logElement = document.getElementById('log');
        const connectButton = document.getElementById('connectButton');
        const disconnectButton = document.getElementById('disconnectButton');
        const sendButton = document.getElementById('sendButton');

        function log(message) {
            const now = new Date().toLocaleTimeString();
            logElement.value += `[${now}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight; // ìŠ¤í¬ë¡¤ í•˜ë‹¨ìœ¼ë¡œ ì´ë™
        }

        function setStatus(text, color = 'gray') {
            statusElement.textContent = `ìƒíƒœ: ${text}`;
            statusElement.className = `text-sm font-medium mb-2 text-${color}-600`;
        }
        
        function updateButtons(isConnected) {
            connectButton.disabled = isConnected;
            disconnectButton.disabled = !isConnected;
            sendButton.disabled = !isConnected;
        }

        function connect() {
            if (ws) {
                log('ì´ë¯¸ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            const url = document.getElementById('websocketUrl').value;
            log(`WebSocket ì—°ê²° ì‹œë„: ${url}`);
            
            try {
                ws = new WebSocket(url);
                setStatus('ì—°ê²° ì¤‘...', 'yellow');

                ws.onopen = () => {
                    setStatus('ì—°ê²° ì„±ê³µ!', 'green');
                    log('âœ… ì„œë²„ì— ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    updateButtons(true);
                };

                ws.onmessage = (event) => {
                    log(`â—€ï¸ ì„œë²„ ì‘ë‹µ: ${event.data}`);
                };

                ws.onclose = (event) => {
                    setStatus('ì—°ê²° ì¢…ë£Œë¨', 'red');
                    log(`âŒ ì—°ê²° ì¢…ë£Œ (ì½”ë“œ: ${event.code}, ì´ìœ : ${event.reason || 'ì—†ìŒ'})`);
                    ws = null;
                    updateButtons(false);
                };

                ws.onerror = (error) => {
                    setStatus('ì˜¤ë¥˜ ë°œìƒ', 'red');
                    log(`ğŸ”¥ WebSocket ì˜¤ë¥˜: ${error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                    ws.close();
                };
            } catch (e) {
                setStatus('ì—°ê²° ì‹¤íŒ¨', 'red');
                log(`ğŸš¨ ì—°ê²° ì‹œë„ ì¤‘ ì˜ˆì™¸ ë°œìƒ: ${e.message}`);
                ws = null;
                updateButtons(false);
            }
        }

        function disconnect() {
            if (ws) {
                log('WebSocket ì—°ê²° í•´ì œ ìš”ì²­...');
                ws.close();
                ws = null;
                setStatus('ì—°ê²° í•´ì œë¨', 'red');
                updateButtons(false);
            } else {
                log('ì—°ê²°ëœ WebSocketì´ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        function sendMessage() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                const message = document.getElementById('messageInput').value;
                ws.send(message);
                log(`â¡ï¸ ëª…ë ¹ ì „ì†¡: ${message}`);
            } else {
                log('â—ï¸ WebSocketì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ë‹«íŒ ìƒíƒœì…ë‹ˆë‹¤.');
                setStatus('ì—°ê²° í•„ìš”', 'orange');
            }
        }

        // ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ ì„¤ì •
        updateButtons(false);

    </script>
</body>
</html>
